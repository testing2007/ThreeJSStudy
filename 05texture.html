<!DOCTYPE html>
<html>

<head>
  <!-- <meta charset="utf-8"> -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>My first three.js app</title>
  <style>
    html,
    body {
      height: 100%;
      margin: 0;
    }

    #c {
      width: 100%;
      height: 100%;
      display: block;
    }
  </style>
</head>

<body>
  <canvas id="c"></canvas>
  <script type="module">
    import * as THREE from './node_modules/three/src/Three.js';
    import { GUI } from './node_modules/three/examples/jsm/libs/lil-gui.module.min.js';
    import XAxisGridHelper from './utility/XAxisGridHelper.js';
    import XDraw from './utility/XDraw.js';

    var renderer, camera, scene, geometry
    const cubes = [];  // just an array we can use to rotate the cubes

    //一个mesh可以通过 不同material + 相同几何体geometry 创建, 例如test2
    function main() {
      // 1: 定义渲染器
      const canvas = document.querySelector('#c');
      renderer = new THREE.WebGLRenderer({ canvas });

      // 2: 把摄像头放在原点的正上方向下看
      const fov = 75;
      const aspect = 2;  // the canvas default
      const near = 0.1;
      const far = 5;
      camera = new THREE.PerspectiveCamera(fov, aspect, near, far);
      camera.position.z = 2

      // 3: 创建场景
      scene = new THREE.Scene();

      // 4: 业务逻辑
      _doLogic()

      // 5: 绘制
      const drawObj = new XDraw(renderer, scene, camera, ()=>{
        cubes.forEach((cube, ndx) => {
          const speed = .2 + ndx * .1;
          // const rot = time * speed;
          cube.rotation.x += 0.005;
          cube.rotation.y += 0.005;
        });
      })
      drawObj.draw()
    }

    function _doLogic() {
      const boxWidth = 1;
      const boxHeight = 1;
      const boxDepth = 1;
      geometry = new THREE.BoxGeometry(boxWidth, boxHeight, boxDepth);

      const loader = new THREE.TextureLoader();

      const material = new THREE.MeshBasicMaterial({
        map: loader.load('./resources/images/wall.jpg'),
      });
      const cube = new THREE.Mesh(geometry, material);
      scene.add(cube);
      cubes.push(cube);  // add to our list of cubes to rotate

      // 方便调试：为每个节点添加一个AxesHelper （红色- X，绿色-Y, 蓝色-Z）
      const gui = new GUI();
      function makeAxisGrid(node, label, units) {
        const helper = new XAxisGridHelper(node, units);
        gui.add(helper, 'visible').name(label);
      }
      makeAxisGrid(cube, 'cube', 26);
    }

    window.onload = main
  </script>
</body>

</html>